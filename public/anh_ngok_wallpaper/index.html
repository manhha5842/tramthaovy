<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Y2K V-Quote Wallpaper ‚ú®</title>

    <!-- T√≠ch h·ª£p Font Pixel Vi·ªát h√≥a t·ª´ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    <!-- T√≠ch h·ª£p FileSaver.js t·ª´ CDN ƒë·ªÉ x·ª≠ l√Ω vi·ªác t·∫£i file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

    <style>
        /* --- ƒê·ªãnh nghƒ©a Theme & Animation --- */
        :root {
            --neon-pink: #ff00ff;
            --neon-purple: #8a2be2;
            --neon-cyan: #00ffff;
            --neon-yellow: #ffff00;
            --dark-blue: #00003b;
            --pixel-font: 'VT323', monospace;
            /* S·ª≠ d·ª•ng font ƒë√£ Vi·ªát h√≥a */
        }

        /* Animation cho hi·ªáu ·ª©ng l·∫•p l√°nh */
        @keyframes sparkle {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
        }

        /* Animation cho hi·ªáu ·ª©ng ph√°t s√°ng */
        @keyframes glow {
            0% {
                text-shadow: 0 0 5px var(--neon-cyan), 0 0 10px var(--neon-cyan), 0 0 15px var(--neon-pink);
            }

            50% {
                text-shadow: 0 0 10px var(--neon-pink), 0 0 15px var(--neon-pink), 0 0 20px var(--neon-yellow);
            }

            100% {
                text-shadow: 0 0 5px var(--neon-cyan), 0 0 10px var(--neon-cyan), 0 0 15px var(--neon-pink);
            }
        }

        body {
            font-family: var(--pixel-font);
            background-color: var(--dark-blue);
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 0, 255, 0.4) 0%, transparent 25%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 255, 0.4) 0%, transparent 25%);
            color: var(--neon-yellow);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Khung ·ª©ng d·ª•ng ch√≠nh --- */
        .container {
            background: rgba(0, 0, 0, 0.5);
            border: 4px solid var(--neon-pink);
            box-shadow: 0 0 25px var(--neon-pink), inset 0 0 15px rgba(255, 0, 255, 0.5);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            width: 100%;
            max-width: 720px;
            /* TƒÉng max-width ƒë·ªÉ canvas hi·ªÉn th·ªã t·ªët h∆°n */
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        h1 {
            color: var(--neon-cyan);
            animation: glow 3s infinite;
            font-size: 2.5rem;
            /* TƒÉng k√≠ch th∆∞·ªõc font cho ti√™u ƒë·ªÅ */
            margin: 0;
            line-height: 1.2;
        }

        .sparkle {
            display: inline-block;
            animation: sparkle 1.5s infinite;
            color: var(--neon-yellow);
        }

        /* --- Khu v·ª±c nh·∫≠p API Key --- */
        .api-key-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .api-key-section label {
            font-size: 1.2rem;
            color: white;
        }

        #unsplash-api-key {
            font-family: var(--pixel-font);
            font-size: 1rem;
            background-color: #222;
            border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 8px;
            text-align: center;
            width: 80%;
            box-shadow: 0 0 10px var(--neon-cyan);
        }

        #unsplash-api-key::placeholder {
            color: #777;
        }

        /* --- Khu v·ª±c hi·ªÉn th·ªã Canvas --- */
        #wallpaperCanvas {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
            background-color: #111;
            border: 2px dashed var(--neon-purple);
            border-radius: 4px;
        }

        /* --- C√°c n√∫t ƒëi·ªÅu khi·ªÉn --- */
        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: var(--pixel-font);
            font-size: 1.2rem;
            color: var(--dark-blue);
            background-color: var(--neon-yellow);
            border: 3px outset #ccc;
            padding: 12px 20px;
            cursor: pointer;
            text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.2);
            transition: all 0.1s ease;
        }

        .btn:hover {
            background-color: var(--neon-cyan);
            box-shadow: 0 0 15px var(--neon-cyan);
        }

        .btn:active {
            border-style: inset;
            transform: translateY(2px);
        }

        .btn:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
            border-color: #444;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>
            <span class="sparkle">‚ú®</span>
            Y2K V-Quote Wallpaper
            <span class="sparkle">‚ú®</span>
        </h1>

        <div class="api-key-section">
            <label for="unsplash-api-key">Unsplash API Key c·ªßa b·∫°n</label>
            <input type="text" id="unsplash-api-key" placeholder="D√°n API key v√†o ƒë√¢y nhaaa">
            <small style="color: var(--neon-cyan); font-size: 0.7rem;">
                B·∫°n ch∆∞a c√≥ API KEY? üëâ <a href="https://unsplash.com/developers" target="_blank"
                    style="color: var(--neon-yellow); text-decoration: underline;">L·∫•y API key Unsplash c·ªßa b·∫°n t·∫°i ƒë√¢y</a>
            </small>
            <small style="color: var(--neon-cyan); font-size: 0.7rem;">
                C√°c b∆∞·ªõc l·∫•y API key:
                <ol style="text-align: left; margin: 0; padding-left: 1.5rem; font-size: 0.8rem;">
                    <li>ƒêƒÉng k√Ω t√†i kho·∫£n Unsplash (n·∫øu ch∆∞a c√≥)</li>
                    <li>Truy c·∫≠p trang <a href="https://unsplash.com/developers" target="_blank"
                            style="color: var(--neon-yellow); text-decoration: underline;">Unsplash Developers</a></li>
                    <li>T·∫°o m·ªôt ·ª©ng d·ª•ng m·ªõi v√† l·∫•y API key</li>
                    <li>Sao ch√©p Access Key v√† d√°n v√†o √¥ b√™n tr√™n</li>
                </ol>
                (L∆∞u √Ω: API key n√†y ch·ªâ d√πng cho m·ª•c ƒë√≠ch c√° nh√¢n, kh√¥ng ƒë∆∞·ª£c chia s·∫ª c√¥ng khai nh√©!)
            </small>

        </div>

        <!-- Canvas ƒë·ªÉ v·∫Ω, k√≠ch th∆∞·ªõc th·∫≠t l√† 1280x720 -->
        <canvas id="wallpaperCanvas" width="1280" height="720"></canvas>

        <div class="controls">
            <button id="fetchBtn" class="btn">L·∫•y Quote + ·∫¢nh M·ªõi</button>
            <button id="downloadBtn" class="btn" disabled>T·∫£i Wallpaper</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- L·∫•y c√°c ph·∫ßn t·ª≠ DOM ---
            const apiKeyInput = document.getElementById('unsplash-api-key');
            const fetchBtn = document.getElementById('fetchBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const canvas = document.getElementById('wallpaperCanvas');
            const ctx = canvas.getContext('2d');

            // --- API & Data ---
            const QUOTES_API_URL = 'https://blv-anh-ngok-said.onrender.com/api/quotes/1';
            let currentImage = null; // Bi·∫øn l∆∞u ·∫£nh hi·ªán t·∫°i ƒë·ªÉ t·∫£i v·ªÅ

            // --- H√†m kh·ªüi t·∫°o ---
            const initialize = () => {
                drawInitialCanvas();
            };

            // --- C√°c h√†m v·∫Ω tr√™n Canvas ---

            // V·∫Ω tr·∫°ng th√°i ban ƒë·∫ßu c·ªßa canvas
            const drawInitialCanvas = () => {
                ctx.fillStyle = '#111';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                drawTextOnCanvas('Nh·∫≠p Unsplash API Key v√† b·∫•m n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu! ^_^', canvas.width / 2, canvas.height / 2);
            };

            // V·∫Ω th√¥ng b√°o l·ªói
            const drawErrorCanvas = (message) => {
                ctx.fillStyle = '#300';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                drawTextOnCanvas(message, canvas.width / 2, canvas.height / 2, '#ff4444');
            };

            // V·∫Ω tr·∫°ng th√°i ƒëang t·∫£i
            const drawLoadingCanvas = () => {
                ctx.fillStyle = '#111';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                drawTextOnCanvas('ƒêang t·∫£i... Ch·ªù x√≠u nha!', canvas.width / 2, canvas.height / 2);
            }

            // H√†m t·ªïng qu√°t ƒë·ªÉ v·∫Ω ·∫£nh v√† quote l√™n canvas
            const drawImageAndQuote = (img, quote) => {
                currentImage = img; // L∆∞u ·∫£nh ƒë·ªÉ d√πng cho ch·ª©c nƒÉng download

                // 1. V·∫Ω ·∫£nh n·ªÅn l·∫•p ƒë·∫ßy canvas
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                // 2. V·∫Ω m·ªôt l·ªõp ph·ªß m·ªù ƒë·ªÉ ch·ªØ d·ªÖ ƒë·ªçc h∆°n
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // 3. V·∫Ω quote l√™n tr√™n
                drawTextOnCanvas(`"${quote}"`, canvas.width / 2, canvas.height / 2);

                downloadBtn.disabled = false; // B·∫≠t n√∫t t·∫£i v·ªÅ khi ƒë√£ c√≥ ·∫£nh
            };

            // H√†m chuy√™n d·ª•ng ƒë·ªÉ v·∫Ω ch·ªØ, c√≥ h·ªó tr·ª£ t·ª± xu·ªëng d√≤ng
            const drawTextOnCanvas = (text, x, y, color = 'var(--neon-yellow)') => {
                // L·∫•y gi√° tr·ªã m√†u t·ª´ CSS variable
                const computedColor = getComputedStyle(document.documentElement).getPropertyValue(color.match(/--[a-z-]+/)[0]).trim();

                ctx.fillStyle = computedColor;
                ctx.strokeStyle = 'black'; // M√†u vi·ªÅn ch·ªØ
                ctx.lineWidth = 8; // ƒê·ªô d√†y vi·ªÅn ch·ªØ
                ctx.font = '52px "VT323"'; // K√≠ch th∆∞·ªõc font ch·ªØ
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // G·ªçi h√†m wrapText ƒë·ªÉ x·ª≠ l√Ω xu·ªëng d√≤ng v√† v·∫Ω
                wrapText(text, x, y, canvas.width * 0.85, 60); // maxWidth l√† 85% chi·ªÅu r·ªông canvas, lineHeight l√† 60px
            };


            // --- Logic ch√≠nh ƒë·ªÉ l·∫•y d·ªØ li·ªáu ---
            const handleFetch = async () => {
                const apiKey = apiKeyInput.value.trim();
                if (!apiKey) {
                    alert('B·∫°n ∆°i, nh·∫≠p Unsplash API Key v√†o ƒë√£ nha! <3');
                    return;
                }

                // Chuy·ªÉn UI sang tr·∫°ng th√°i ƒëang t·∫£i
                fetchBtn.disabled = true;
                downloadBtn.disabled = true;
                drawLoadingCanvas();

                try {
                    // 1. L·∫•y Quote Ti·∫øng Vi·ªát ng·∫´u nhi√™n
                    const quoteResponse = await fetch(QUOTES_API_URL);
                    if (!quoteResponse.ok) throw new Error('Kh√¥ng th·ªÉ l·∫•y quote. API c√≥ th·ªÉ ƒëang b·∫£o tr√¨.');
                    const quoteData = await quoteResponse.json();
                    const randomQuote = quoteData.data[0];

                    // 2. L·∫•y ·∫£nh ng·∫´u nhi√™n t·ª´ Unsplash
                    const unsplashUrl = `https://api.unsplash.com/photos/random?client_id=${apiKey}&query=abstract,sky,neon,nature,aesthetic,cityscape,vaporwave&orientation=landscape`;
                    const imageResponse = await fetch(unsplashUrl);
                    if (!imageResponse.ok) {
                        throw new Error(`L·ªói Unsplash API: ${imageResponse.status}. Key c·ªßa b·∫°n c√≥ ƒë√∫ng kh√¥ng?`);
                    }
                    const imageData = await imageResponse.json();
                    const imageUrl = imageData.urls.regular;

                    // 3. T·∫£i ·∫£nh v√† v·∫Ω l√™n canvas
                    const img = new Image();
                    img.crossOrigin = "Anonymous"; // R·∫§T QUAN TR·ªåNG: ƒë·ªÉ canvas kh√¥ng b·ªã "tainted" v√† cho ph√©p t·∫£i v·ªÅ
                    img.onload = () => drawImageAndQuote(img, randomQuote); // Khi ·∫£nh t·∫£i xong, v·∫Ω n√≥ v√† quote l√™n
                    img.onerror = () => { throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c ·∫£nh t·ª´ Unsplash."); };
                    img.src = imageUrl;

                } catch (error) {
                    console.error('L·ªói trong qu√° tr√¨nh l·∫•y d·ªØ li·ªáu:', error);
                    drawErrorCanvas(error.message);
                } finally {
                    fetchBtn.disabled = false; // B·∫≠t l·∫°i n√∫t fetch d√π th√†nh c√¥ng hay th·∫•t b·∫°i
                }
            };

            // --- Logic t·∫£i ·∫£nh v·ªÅ ---
            const handleDownload = () => {
                if (!currentImage) {
                    alert("Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ t·∫£i, b·∫°n t·∫°o m·ªôt c√°i ƒë√£ nha!");
                    return;
                }
                // Chuy·ªÉn n·ªôi dung canvas th√†nh m·ªôt file Blob
                canvas.toBlob((blob) => {
                    // S·ª≠ d·ª•ng FileSaver.js ƒë·ªÉ m·ªü h·ªôp tho·∫°i l∆∞u file
                    saveAs(blob, 'y2k-v-quote.png');
                });
            };

            // --- Ti·ªán √≠ch: T·ª± ƒë·ªông xu·ªëng d√≤ng cho ch·ªØ tr√™n Canvas ---
            function wrapText(text, x, y, maxWidth, lineHeight) {
                const words = text.split(' ');
                let line = '';
                let testLine = '';
                let lineArray = [];

                // Chia c√¢u th√†nh c√°c d√≤ng d·ª±a tr√™n maxWidth
                for (let n = 0; n < words.length; n++) {
                    testLine = line + words[n] + ' ';
                    let metrics = ctx.measureText(testLine);
                    let testWidth = metrics.width;
                    if (testWidth > maxWidth && n > 0) {
                        lineArray.push(line);
                        line = words[n] + ' ';
                    } else {
                        line = testLine;
                    }
                }
                lineArray.push(line);

                // T√≠nh to√°n v·ªã tr√≠ Y b·∫Øt ƒë·∫ßu ƒë·ªÉ cƒÉn gi·ªØa to√†n b·ªô kh·ªëi vƒÉn b·∫£n
                const startY = y - (lineArray.length - 1) * lineHeight / 2;

                // V·∫Ω t·ª´ng d√≤ng l√™n canvas
                for (let i = 0; i < lineArray.length; i++) {
                    const currentY = startY + (i * lineHeight);
                    // V·∫Ω vi·ªÅn tr∆∞·ªõc, r·ªìi m·ªõi v·∫Ω ch·ªØ ƒë√® l√™n
                    ctx.strokeText(lineArray[i].trim(), x, currentY);
                    ctx.fillText(lineArray[i].trim(), x, currentY);
                }
            }

            // --- G·∫Øn c√°c s·ª± ki·ªán cho n√∫t b·∫•m ---
            fetchBtn.addEventListener('click', handleFetch);
            downloadBtn.addEventListener('click', handleDownload);

            // --- Ch·∫°y h√†m kh·ªüi t·∫°o ---
            initialize();
        });
    </script>
</body>

</html>
```